
<% layout('layout') %>
<div class="container mt-5">
  <h1 class="mb-4">Bienvenue, <%= user.name  || "Ã‰tudiant" %> !</h1>

  <%- include('partials/header') %>

  <h2 class="mb-3">ğŸ“… CrÃ©neaux disponibles</h2>
  <p>Contacter <%= user.name %> : </p>
  <!-- Lien pour contacter -->
<a href="https://mail.google.com/mail/?view=cm&fs=1&to=<%= user.email %>" target="_blank">
  <%= user.email %>
</a>

  <% if (slots.length === 0) { %>
    <p class="text-muted">Aucun crÃ©neau disponible pour l'instant.</p>
  <% } else { %>
    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>Date</th>
          <th>Heure</th>
          <th>Enseignant</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <% slots.forEach(slot => { %>
          <tr>
            <!-- ğŸ—“ï¸ Date -->
        <td><%= slot.date %></td>



        <!-- â° Heure (extrait HH:MM depuis HH:MM:SS) -->
        <td><%= slot.time ? slot.time.slice(0, 5) : 'â€”' %></td>
            <td><%= slot.teacher_name %></td>
            <td>
              <% if (!slot.booking_id) { %>
                <a href="/book/<%= slot.id %>" class="btn btn-success btn-sm">RÃ©server</a>
              <% } else if (slot.student_id === session.userId) { %>
                <form action="/cancel-booking/<%= slot.booking_id %>" method="POST" style="display:inline;">
                  <button type="submit" class="btn btn-danger btn-sm">Annuler</button>
                </form>
              <% } else { %>
                RÃ©servÃ©
              <% } %>
            </td>
          </tr>
        <% }); %>
      </tbody>
    </table>
  <% } %>

  <h3>Messages reÃ§us <% if (unreadCount > 0) { %><span class="badge bg-danger"><%= unreadCount %></span><% } %></h3>

  <% if (messages && messages.length > 0) { %>
    <ul class="list-group mt-3">
      <% messages.forEach(msg => { %>
        <li class="list-group-item d-flex justify-content-between align-items-center
          <% if (msg.lu === 0) { %>list-group-item-warning<% } %>">
          <div>
            <strong>De :</strong> <%= msg.sender_name %><br>
            <strong>Message :</strong> <%= msg.content.length > 50 ? msg.content.substring(0, 50) + '...' : msg.content %>
          </div>
          <a href="/message/<%= msg.id %>" class="btn btn-sm btn-primary">Voir</a>
        </li>
      <% }) %>
    </ul>
  <% } else { %>
    <p class="text-muted">Vous n'avez aucun message.</p>
  <% } %>

  <div class="d-flex justify-content-end mb-3">
  <a href="/messages/send" class="btn btn-primary me-2">ğŸ“¨ Envoyer un message</a>
  <a href="/messages" class="btn btn-secondary">ğŸ“¥ Lire les messages</a>
  
  


</div>

</div>
<%- include('partials/footer') %>